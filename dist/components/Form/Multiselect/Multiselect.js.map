{"version":3,"sources":["../../../../src/components/Form/Multiselect/Multiselect.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  FocusEvent,\n  forwardRef,\n  InputHTMLAttributes,\n  KeyboardEvent,\n  MouseEvent,\n  useCallback,\n  useEffect,\n  useId,\n  useRef,\n  useState,\n} from \"react\";\nimport styles from \"./Multiselect.module.css\";\n\nimport { Keys } from \"helpers/accessibility\";\nimport { classNames } from \"helpers/classNames\";\nimport { callMultiple } from \"helpers/function\";\nimport { multipleRef } from \"helpers/react/refs\";\nimport { useGlobalClicks } from \"hooks/useGlobalClicks\";\n\nimport { Icon20ChevronDown } from \"icons/20/chevron_down\";\n\nimport {\n  FormInput,\n  FormPublicProps,\n} from \"components/Form/FormInput/FormInput\";\nimport {\n  MultiselectBase,\n  MultiselectBaseProps,\n} from \"./components/MultiselectBase/MultiselectBase\";\nimport {\n  MultiselectDropdown,\n  MultiselectDropdownProps,\n} from \"./components/MultiselectDropdown/MultiselectDropdown\";\nimport {\n  FOCUS_ACTION_NEXT,\n  FOCUS_ACTION_PREV,\n  FocusActionType,\n  isServicePreset,\n} from \"./hooks/constants\";\nimport { useMultiselect, UseMultiselectProps } from \"./hooks/useMultiselect\";\nimport { MultiselectOption } from \"./types\";\n\nexport interface MultiselectProps\n  extends Omit<\n      InputHTMLAttributes<HTMLInputElement>,\n      \"value\" | \"defaultValue\" | \"onChange\"\n    >,\n    Omit<FormPublicProps, \"after\">,\n    Pick<MultiselectDropdownProps, \"closeDropdownAfterSelect\" | \"renderOption\">,\n    Pick<\n      UseMultiselectProps,\n      | \"value\"\n      | \"defaultValue\"\n      | \"onChange\"\n      | \"filterFn\"\n      | \"onInputChange\"\n      | \"inputValue\"\n      | \"selectedBehavior\"\n      | \"emptyText\"\n      | \"creatable\"\n    >,\n    Pick<MultiselectBaseProps, \"renderChip\"> {\n  /**\n   * The `options` property defines the available options within the multiselect dropdown.\n   * Each option is represented as an object conforming to the `MultiselectOption` structure,\n   * which typically includes properties like `value` (the option's value) and `label` (the human-readable text associated with the option).\n   */\n  options: MultiselectOption[];\n  /**\n   * Optional custom container to render the dropdown into, overrides the default from context.\n   * When provided, the dropdown will be rendered into this container instead of the default portal container.\n   */\n  portalContainer?: HTMLElement | null;\n}\n\n/**\n * A comprehensive component for rendering a multiselect input field with customizable options, dropdown behaviors, and chip display.\n * It integrates functionality for selecting multiple options, searching, and even creating new options based on user input.\n */\nexport const Multiselect = forwardRef<HTMLDivElement, MultiselectProps>(\n  (\n    {\n      // FormInput options\n      header,\n      before,\n      status,\n      className,\n      children,\n      disabled,\n\n      // CustomSelectDropdownProps\n      options: optionsProp,\n      closeDropdownAfterSelect = false,\n      selectedBehavior,\n      emptyText,\n      creatable = false,\n      filterFn,\n\n      // MultiselectInputProps\n      value: valueProp = [],\n      defaultValue,\n      inputValue: inputValueProp,\n      renderChip,\n      renderOption,\n      onInputChange: onInputChangeProp,\n      onChange,\n      onFocus,\n      onBlur,\n      onKeyDown,\n\n      // Portal container\n      portalContainer,\n\n      ...restProps\n    },\n    ref\n  ) => {\n    const {\n      // Option props\n      value,\n      addOptionFromInput,\n      addOption,\n      removeOption,\n\n      // Input props\n      inputRef,\n      inputValue,\n      clearInput,\n      onInputChange,\n\n      // Dropdown props\n      options,\n      opened,\n      setOpened,\n      focusedOption,\n      focusedOptionIndex,\n      setFocusedOption,\n      setFocusedOptionIndex,\n    } = useMultiselect({\n      // Option props\n      value: valueProp,\n      defaultValue,\n      onChange,\n\n      // Input props\n      inputValue: inputValueProp,\n      onInputChange: onInputChangeProp,\n\n      // Dropdown props\n      options: optionsProp,\n      emptyText,\n      creatable,\n      filterFn,\n      selectedBehavior,\n\n      // Other props\n      disabled,\n    });\n\n    const containerRef = useRef<HTMLDivElement>(null);\n    const rootRef = useRef(null);\n    const chevronRef = useRef<SVGSVGElement>(null);\n    const wasChevronClickedRef = useRef(false);\n\n    const dropdownAriaId = useId();\n    const dropdownScrollBoxRef = useRef<HTMLDivElement>(null);\n\n    // State to control whether focus should open the dropdown\n    const [shouldOpenOnFocus, setShouldOpenOnFocus] = useState(true);\n\n    // Track if we're in the process of toggling via the chevron\n    const isTogglingRef = useRef(false);\n\n    const handleFocus = () => {\n      console.log(\n        \"handleFocus - shouldOpenOnFocus:\",\n        shouldOpenOnFocus,\n        \"opened:\",\n        opened,\n        \"isToggling:\",\n        isTogglingRef.current\n      );\n\n      // If we're in the process of toggling via the chevron, don't change the dropdown state\n      if (isTogglingRef.current) {\n        console.log(\"  -> Ignoring focus during chevron toggle\");\n        return;\n      }\n\n      // Only open the dropdown if we should open on focus\n      if (shouldOpenOnFocus) {\n        console.log(\"  -> Opening dropdown from focus\");\n        setOpened(true);\n        setFocusedOptionIndex(null);\n      } else {\n        console.log(\"  -> Not opening dropdown due to shouldOpenOnFocus flag\");\n      }\n\n      // Reset the flag for next focus\n      setShouldOpenOnFocus(true);\n      console.log(\"  -> Reset shouldOpenOnFocus to true\");\n    };\n\n    const handleBlur = (event: FocusEvent<HTMLInputElement>) => {\n      console.log(\"handleBlur - relatedTarget:\", event.relatedTarget);\n\n      // If we're in the process of toggling via the chevron, don't do anything\n      if (isTogglingRef.current) {\n        console.log(\"  -> Ignoring blur during chevron toggle\");\n        return;\n      }\n\n      if (!event.defaultPrevented && !creatable) {\n        event.preventDefault();\n      }\n    };\n\n    const optionsNodes = useRef<HTMLElement[]>([]).current;\n    const scrollToElement = (index: number, center = false) => {\n      const dropdown = dropdownScrollBoxRef.current;\n      const item = optionsNodes[index];\n\n      if (!item || !dropdown) {\n        return;\n      }\n\n      const dropdownHeight = dropdown.offsetHeight;\n      const { scrollTop } = dropdown;\n      const itemTop = item.offsetTop;\n      const itemHeight = item.offsetHeight;\n\n      if (center) {\n        dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n      } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n        dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n      } else if (itemTop < scrollTop) {\n        dropdown.scrollTop = itemTop;\n      }\n    };\n\n    const focusOptionByIndex = (index: number, oldIndex: number | null) => {\n      let focusedIndex = index;\n      const { length } = options;\n\n      if (index < 0) {\n        focusedIndex = length - 1;\n      } else if (index >= length) {\n        focusedIndex = 0;\n      }\n\n      if (focusedIndex === oldIndex) {\n        return;\n      }\n\n      scrollToElement(focusedIndex);\n      setFocusedOptionIndex(focusedIndex);\n    };\n\n    const focusOption = (nextIndex: number | null, type: FocusActionType) => {\n      let index = nextIndex === null ? -1 : nextIndex;\n\n      if (type === FOCUS_ACTION_NEXT) {\n        index += 1;\n      }\n\n      if (type === FOCUS_ACTION_PREV) {\n        index -= 1;\n      }\n\n      focusOptionByIndex(index, focusedOptionIndex);\n    };\n\n    const handleKeyDown = (event: KeyboardEvent<HTMLInputElement>) => {\n      if (event.defaultPrevented) {\n        return;\n      }\n\n      switch (event.key) {\n        case Keys.ARROW_UP:\n        case Keys.ARROW_DOWN:\n          event.preventDefault();\n\n          if (opened) {\n            focusOption(\n              focusedOptionIndex,\n              event.key === Keys.ARROW_UP\n                ? FOCUS_ACTION_PREV\n                : FOCUS_ACTION_NEXT\n            );\n            return;\n          }\n\n          setOpened(true);\n          setFocusedOptionIndex(0);\n          break;\n\n        case Keys.ENTER: {\n          if (!opened) {\n            break;\n          }\n\n          if (!creatable) {\n            event.preventDefault();\n          }\n\n          if (focusedOptionIndex === null) {\n            break;\n          }\n\n          const foundOption = options[focusedOptionIndex];\n          if (!foundOption || isServicePreset(foundOption)) {\n            break;\n          }\n\n          event.preventDefault();\n          addOption(foundOption);\n          setFocusedOptionIndex(null);\n          clearInput();\n\n          closeDropdownAfterSelect && setOpened(false);\n          break;\n        }\n\n        case Keys.ESCAPE:\n        case Keys.TAB:\n          opened && setOpened(false);\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    useEffect(() => {\n      if (focusedOptionIndex === null) {\n        setFocusedOption(null);\n        return;\n      }\n\n      const foundFocusedOptionIndex = options[focusedOptionIndex];\n      if (\n        foundFocusedOptionIndex &&\n        !isServicePreset(foundFocusedOptionIndex)\n      ) {\n        setFocusedOption(foundFocusedOptionIndex);\n      }\n    }, [options, focusedOptionIndex, setFocusedOption]);\n\n    const onDropdownMouseLeave = useCallback(() => {\n      setFocusedOptionIndex(null);\n    }, [setFocusedOptionIndex]);\n\n    // Handle chevron mousedown to prevent focus issues\n    // Using mousedown instead of click ensures this runs before blur/focus events\n    const handleChevronMouseDown = (e: MouseEvent<SVGSVGElement>) => {\n      // Prevent the default behavior which would cause focus/blur events\n      e.preventDefault();\n      // Stop propagation to prevent other handlers from firing\n      e.stopPropagation();\n\n      console.log(\n        \"handleChevronMouseDown - opened:\",\n        opened,\n        \"shouldOpenOnFocus:\",\n        shouldOpenOnFocus\n      );\n\n      // Set the toggling flag to prevent focus/blur handlers from interfering\n      isTogglingRef.current = true;\n      // Set the chevron clicked flag to prevent handleClickOutside from closing the dropdown\n      wasChevronClickedRef.current = true;\n\n      // Toggle the dropdown state\n      if (opened) {\n        console.log(\"  -> Closing dropdown from chevron\");\n        setShouldOpenOnFocus(false);\n        setOpened(false);\n      } else {\n        console.log(\"  -> Opening dropdown from chevron\");\n        setOpened(true);\n      }\n\n      // Focus the input and reset the toggling flag after a delay\n      setTimeout(() => {\n        if (!opened) {\n          console.log(\"  -> Focusing input after delay\");\n          inputRef.current?.focus();\n        }\n\n        // Reset the toggling flag\n        console.log(\"  -> Resetting isToggling flag\");\n        isTogglingRef.current = false;\n\n        // Reset the chevron clicked flag after a delay\n        setTimeout(() => {\n          wasChevronClickedRef.current = false;\n        }, 100);\n      }, 100);\n    };\n\n    const handleClickOutside = useCallback(() => {\n      console.log(\n        \"handleClickOutside - wasChevronClicked:\",\n        wasChevronClickedRef.current\n      );\n\n      // Don't close the dropdown if the chevron was clicked\n      if (wasChevronClickedRef.current) {\n        console.log(\"  -> Ignoring click outside due to chevron click\");\n        return;\n      }\n\n      // Don't reopen on next focus\n      setShouldOpenOnFocus(false);\n      setOpened(false);\n    }, [setOpened]);\n\n    useGlobalClicks(\n      handleClickOutside,\n      opened ? rootRef : null,\n      opened ? dropdownScrollBoxRef : null\n    );\n\n    const controlledStatus = status || (opened ? \"focused\" : \"default\");\n\n    return (\n      <FormInput\n        ref={multipleRef(ref, containerRef)}\n        header={header}\n        before={before}\n        status={controlledStatus}\n        disabled={disabled}\n        className={classNames(styles.wrapper, className)}\n      >\n        <MultiselectBase\n          {...restProps}\n          // FormFieldProps\n          ref={rootRef}\n          className={styles.base}\n          // Option props\n          onAddChipOption={addOptionFromInput}\n          onRemoveChipOption={removeOption}\n          renderChip={renderChip}\n          chipsValue={value}\n          // Input props\n          value={inputValue}\n          inputRef={inputRef}\n          onChange={onInputChange}\n          onFocus={callMultiple(handleFocus, onFocus)}\n          onBlur={callMultiple(handleBlur, onBlur)}\n          onKeyDown={callMultiple(handleKeyDown, onKeyDown)}\n          // a11y props\n          role=\"combobox\"\n          aria-expanded={opened}\n          aria-controls={dropdownAriaId}\n          aria-haspopup=\"listbox\"\n        />\n        <Icon20ChevronDown\n          ref={chevronRef}\n          aria-hidden\n          onMouseDown={handleChevronMouseDown}\n          className={styles.chevron}\n        />\n        {opened && (\n          <MultiselectDropdown\n            ref={dropdownScrollBoxRef}\n            dropdownAriaId={dropdownAriaId}\n            options={options}\n            onMouseLeave={onDropdownMouseLeave}\n            targetRef={rootRef}\n            addOptionFromInput={() => addOptionFromInput(inputValue)}\n            setFocusedOptionIndex={setFocusedOptionIndex}\n            renderOption={renderOption}\n            focusedOption={focusedOption}\n            value={value}\n            setOptionNode={(index, node) => {\n              optionsNodes[index] = node;\n            }}\n            setOpened={setOpened}\n            closeDropdownAfterSelect={closeDropdownAfterSelect}\n            addOption={addOption}\n            clearInput={clearInput}\n            focusedOptionIndex={focusedOptionIndex}\n            portalContainer={portalContainer}\n          />\n        )}\n      </FormInput>\n    );\n  }\n);\n"],"names":["forwardRef","useCallback","useEffect","useId","useRef","useState","Keys","classNames","callMultiple","multipleRef","useGlobalClicks","Icon20ChevronDown","FormInput","MultiselectBase","MultiselectDropdown","FOCUS_ACTION_NEXT","FOCUS_ACTION_PREV","isServicePreset","useMultiselect","Multiselect","ref","header","before","status","className","children","disabled","options","optionsProp","closeDropdownAfterSelect","selectedBehavior","emptyText","creatable","filterFn","value","valueProp","defaultValue","inputValue","inputValueProp","renderChip","renderOption","onInputChange","onInputChangeProp","onChange","onFocus","onBlur","onKeyDown","portalContainer","restProps","addOptionFromInput","addOption","removeOption","inputRef","clearInput","opened","setOpened","focusedOption","focusedOptionIndex","setFocusedOption","setFocusedOptionIndex","containerRef","rootRef","chevronRef","wasChevronClickedRef","dropdownAriaId","dropdownScrollBoxRef","shouldOpenOnFocus","setShouldOpenOnFocus","isTogglingRef","handleFocus","console","log","current","handleBlur","event","relatedTarget","defaultPrevented","preventDefault","optionsNodes","scrollToElement","index","center","dropdown","item","dropdownHeight","offsetHeight","scrollTop","itemTop","offsetTop","itemHeight","focusOptionByIndex","oldIndex","focusedIndex","length","focusOption","nextIndex","type","handleKeyDown","key","ARROW_UP","ARROW_DOWN","ENTER","foundOption","ESCAPE","TAB","foundFocusedOptionIndex","onDropdownMouseLeave","handleChevronMouseDown","e","stopPropagation","setTimeout","focus","handleClickOutside","controlledStatus","onAddChipOption","onRemoveChipOption","chipsValue","role","aria-expanded","aria-controls","aria-haspopup","aria-hidden","onMouseDown","onMouseLeave","targetRef","setOptionNode","node"],"mappings":"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"}