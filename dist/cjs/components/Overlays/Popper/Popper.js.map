{"version":3,"sources":["../../../../../src/components/Overlays/Popper/Popper.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  ElementType,\n  forwardRef,\n  HTMLAttributes,\n  RefObject,\n  useState,\n} from \"react\";\nimport styles from \"./Popper.module.css\";\n\nimport { classNames } from \"helpers/classNames\";\nimport { multipleRef } from \"helpers/react/refs\";\nimport { useEnhancedEffect } from \"hooks/useEnhancedEffect\";\n\nimport { useFloating, VirtualElement } from \"@floating-ui/react-dom\";\n\nimport { RootRenderer } from \"components/Service/RootRenderer/RootRenderer\";\nimport {\n  FloatingArrow,\n  FloatingArrowProps,\n} from \"./components/FloatingArrow/FloatingArrow\";\nimport {\n  DEFAULT_ARROW_HEIGHT,\n  DEFAULT_ARROW_PADDING,\n} from \"./components/FloatingArrow/icons/arrow\";\nimport { autoUpdateFloatingElement } from \"./helpers/autoUpdateFloatingElement\";\nimport {\n  useFloatingMiddlewares,\n  UseFloatingMiddlewaresOptions,\n} from \"./hooks/useFloatingMiddlewares\";\n\nexport interface PopperProps\n  extends Omit<\n      UseFloatingMiddlewaresOptions,\n      \"arrowHeight\" | \"arrowPadding\" | \"arrowRef\"\n    >,\n    HTMLAttributes<HTMLDivElement> {\n  /** Reference to the target element or virtual element for precise positioning. */\n  targetRef: RefObject<HTMLElement> | VirtualElement;\n  /** Configuration and customization options for the floating arrow component. */\n  arrowProps?: FloatingArrowProps & {\n    /** Optionally override the default arrow height. */\n    height?: number;\n    /** Optionally override the default arrow padding. */\n    padding?: number;\n  };\n  /** Optional custom component for the arrow icon, replacing the default. */\n  ArrowIcon?: FloatingArrowProps[\"Icon\"] | null;\n  /** Defines the root element type of the Popper, allowing for semantic customization. */\n  Component?: ElementType;\n  /** Opt-in feature to automatically update Popper's position when the target element resizes. */\n  autoUpdateOnTargetResize?: boolean;\n  /** Optional custom container to render the portal into, overrides the default from context */\n  portalContainer?: HTMLElement | null;\n}\n\n/**\n * Renders a Popper component, leveraging floating UI for dynamic, responsive positioning.\n * Supports advanced configurations like virtual elements, custom arrows, and auto-position updates.\n */\nexport const Popper = forwardRef(\n  (\n    {\n      // UseFloatingMiddlewaresOptions\n      placement = \"auto\",\n      sameWidth,\n      offsetByMainAxis = 8,\n      offsetByCrossAxis = 0,\n      withArrow = true,\n      customMiddlewares,\n\n      // UseFloatingProps\n      autoUpdateOnTargetResize = false,\n\n      // ArrowProps\n      arrowProps,\n      ArrowIcon,\n\n      Component = \"div\",\n      style,\n      targetRef,\n      className,\n      children,\n      portalContainer,\n      ...restProps\n    }: PopperProps,\n    ref\n  ) => {\n    const [arrowRef, setArrowRef] = useState<HTMLDivElement | null>(null);\n\n    const { strictPlacement, middlewares } = useFloatingMiddlewares({\n      placement,\n      sameWidth,\n      withArrow,\n      arrowRef,\n      arrowHeight: arrowProps?.height || DEFAULT_ARROW_HEIGHT,\n      arrowPadding: arrowProps?.padding || DEFAULT_ARROW_PADDING,\n      offsetByMainAxis,\n      offsetByCrossAxis,\n      customMiddlewares,\n    });\n\n    const {\n      placement: resolvedPlacement,\n      refs,\n      middlewareData,\n      floatingStyles,\n    } = useFloating({\n      placement: strictPlacement,\n      middleware: middlewares,\n      whileElementsMounted(...args) {\n        return autoUpdateFloatingElement(...args, {\n          elementResize: autoUpdateOnTargetResize,\n        });\n      },\n    });\n\n    // Debug logging for placement resolution with platform detection\n    useEnhancedEffect(() => {\n      if (process.env.NODE_ENV === 'development') {\n        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        \n        console.log('[Popper Debug] Platform info:', {\n          userAgent: navigator.userAgent,\n          isIOS,\n          isMobile,\n          viewportWidth: window.innerWidth,\n          viewportHeight: window.innerHeight,\n          screenHeight: window.screen.height,\n          availHeight: window.screen.availHeight,\n        });\n        \n        console.log('[Popper Debug] Placement:', {\n          initial: placement,\n          strict: strictPlacement,\n          resolved: resolvedPlacement,\n        });\n        \n        console.log('[Popper Debug] Middleware data:', middlewareData);\n        console.log('[Popper Debug] Floating styles:', floatingStyles);\n        \n        // Log autoPlacement details\n        if (middlewareData.autoPlacement) {\n          console.log('[Popper Debug] AutoPlacement:', {\n            index: middlewareData.autoPlacement.index,\n            overflowsCount: middlewareData.autoPlacement.overflows?.length,\n            overflows: middlewareData.autoPlacement.overflows,\n          });\n        }\n        \n        // Log reference and floating element dimensions\n        if (refs.reference && refs.floating) {\n          const refRect = (refs.reference as any).getBoundingClientRect?.();\n          const floatRect = (refs.floating as any).getBoundingClientRect?.();\n          if (refRect && floatRect) {\n            console.log('[Popper Debug] Element positions:', {\n              reference: refRect,\n              floating: floatRect,\n              spaceAbove: refRect.top,\n              spaceBelow: window.innerHeight - refRect.bottom,\n              dropdownHeight: floatRect.height,\n              shouldGoUp: floatRect.height > (window.innerHeight - refRect.bottom),\n            });\n          }\n        }\n      }\n    }, [placement, strictPlacement, resolvedPlacement, middlewareData, floatingStyles, refs]);\n\n    useEnhancedEffect(() => {\n      refs.setReference(\"current\" in targetRef ? targetRef.current : targetRef);\n    }, [refs.setReference, targetRef]);\n\n    return (\n      <RootRenderer customContainer={portalContainer}>\n        <Component\n          {...restProps}\n          ref={multipleRef(ref, refs.setFloating)}\n          style={{ ...style, ...floatingStyles }}\n          className={classNames(styles.wrapper, className)}\n        >\n          {withArrow && (\n            <FloatingArrow\n              {...arrowProps}\n              coords={middlewareData.arrow}\n              placement={resolvedPlacement}\n              ref={setArrowRef}\n              {...(ArrowIcon ? { Icon: ArrowIcon } : {})}\n            />\n          )}\n          {children}\n        </Component>\n      </RootRenderer>\n    );\n  }\n);\n"],"names":["Popper","forwardRef","ref","placement","sameWidth","offsetByMainAxis","offsetByCrossAxis","withArrow","customMiddlewares","autoUpdateOnTargetResize","arrowProps","ArrowIcon","Component","style","targetRef","className","children","portalContainer","restProps","arrowRef","setArrowRef","useState","strictPlacement","middlewares","useFloatingMiddlewares","arrowHeight","height","DEFAULT_ARROW_HEIGHT","arrowPadding","padding","DEFAULT_ARROW_PADDING","resolvedPlacement","refs","middlewareData","floatingStyles","useFloating","middleware","whileElementsMounted","args","autoUpdateFloatingElement","elementResize","useEnhancedEffect","process","env","NODE_ENV","isIOS","test","navigator","userAgent","isMobile","console","log","viewportWidth","window","innerWidth","viewportHeight","innerHeight","screenHeight","screen","availHeight","initial","strict","resolved","autoPlacement","index","overflowsCount","overflows","length","reference","floating","refRect","getBoundingClientRect","floatRect","spaceAbove","top","spaceBelow","bottom","dropdownHeight","shouldGoUp","setReference","current","RootRenderer","customContainer","multipleRef","setFloating","classNames","FloatingArrow","coords","arrow","Icon"],"mappings":"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"}